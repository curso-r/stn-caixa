---
output:
  pdf_document: default
  html_document: default
---
# Quadro analítico preditivo 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE, 
  warning = FALSE, 
  eval = TRUE
)

library(tidyverse)
```

## Construção do Indicador SE

O indicador SE (suspeita de empoçamento) é uma estimativa da probabilidade de uma série temporal de disponibilidade líquida ser de uma UG/Fonte empoçada. Para derivar essas probabilidades de empoçamento, a metodologia envolveu duas macro-etapas:

1) Retulagem das séries temporais em "empoçadas" e "não empoçadas";
2) Aplicação de métodos estatísticos de aprendizagem de máquina, especificamente o método do *XGBoost* [@xgboost], um algorítmo da classe dos "Gradient Boostings" [@esl].

### Rotulagem

A rotulagem foi elaborada em colaboração entre a equipe da R6 com a equipe do GT-CEAD. Os analistas rotularam 1223 séries temporais como ou "empoçada" ou "não empoçada". Tais anotações serviram como os alvos (variável resposta) para alimentar o algoritmo de aprendizagem de máquina.

### Modelo de Aprendizagem de Máquina

A modelagem preditiva consideraram as seguintes variáveis:

**Variável Resposta**: empocamento (rótulos "empoçada"/"não empoçada")

**Variáveis Explicativas**: os indicadores descritos no capítulo 3, a saber:

- Disponibilidade Líquida Sobre Gastos (DLSG)
- Índice acumulação de disponibilidade líquida (IADL)
- Indicador de persistência de saldo positivo (IPDL)                               
- Valor Nominal (VN)                   
- Valor Nominal Conservador (VNC)
- Tempo Positivo (TP)

**Modelo Preditivo**: XGBoost

**Software**: R

**Código Fonte**: https://github.com/curso-r/empocamento/blob/master/inst/scripts/06-xgboost.R

**Acurácia**: O algoritmo acertou 94% das séries temporais da base de dados de teste.

## Resultados

### Fontes de recursos que tendem a acumular recurso

```{r, fig.height=8}
indicadores <- read_rds("../data/indicadores.rds")

indicadores_lm <- lm(disponibilidade_estritamente_crescente ~ NO_FONTE_RECURSO, data = indicadores)

indicadores_contagem <- indicadores %>%
  ungroup() %>%
  count(NO_FONTE_RECURSO) %>%
  filter(n > 10)

indicadores %>%
  group_by(NO_FONTE_RECURSO) %>%
  filter(n() > 10) %>%
  ungroup %>%
  mutate(
    NO_FONTE_RECURSO = fct_reorder(NO_FONTE_RECURSO, disponibilidade_estritamente_crescente, .fun = median, na.rm = TRUE)
  ) %>%
  ggplot(aes(x = NO_FONTE_RECURSO, y = disponibilidade_estritamente_crescente)) +
  geom_boxplot() +
  geom_label(aes(label = n, y = -0.1), data = indicadores_contagem, size = 3) +
  coord_flip() +
  theme_minimal(9) +
  labs(y = "Indicador de fonte de recurso acumulante", x = "")
```

A tendência é que as fontes de recursos 

- **destinados às atividades com fins de seguridade social**, 
- **não financeiros diretamente arrecadados** e 
- **ordinários** 

tenham perfil recursos de acumulantes enquanto que as fontes de recursos 

- **de consessões e permissões**,
- **livres da seguridade social**,
- **fundo social parcialmente destinados à educação pública e saúde**,
- **destinados a manutenção e desenvolvimento do ensino** e 
- **de alienação de bens e direito do patrimônio público** 

tendem a não acumularem.



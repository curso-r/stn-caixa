<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 2 Projeto Caixa | Documentação do projeto ‘Execução Orçamentária e Financeira do Governo Federal’ (STN/BID)</title>
  <meta name="description" content="STN-Caixa" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 2 Projeto Caixa | Documentação do projeto ‘Execução Orçamentária e Financeira do Governo Federal’ (STN/BID)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="STN-Caixa" />
  <meta name="github-repo" content="curso-r/stn" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 2 Projeto Caixa | Documentação do projeto ‘Execução Orçamentária e Financeira do Governo Federal’ (STN/BID)" />
  
  <meta name="twitter:description" content="STN-Caixa" />
  

<meta name="author" content="Athos Damiani, Daniel Falbel, William Amorim" />


<meta name="date" content="2019-12-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="bases-de-dados.html"/>
<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Relatório de análise de dados</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introdução</a></li>
<li class="chapter" data-level="2" data-path="projeto-caixa.html"><a href="projeto-caixa.html"><i class="fa fa-check"></i><b>2</b> Projeto Caixa</a><ul>
<li class="chapter" data-level="2.1" data-path="projeto-caixa.html"><a href="projeto-caixa.html#é-preciso-de-início-conhecer-o-perfil-das-despesas-e-receitas-orçamentárias-desses-órgãos."><i class="fa fa-check"></i><b>2.1</b> É preciso de início conhecer o perfil das despesas e receitas orçamentárias desses órgãos.</a></li>
<li class="chapter" data-level="2.2" data-path="projeto-caixa.html"><a href="projeto-caixa.html#como-fazer-isso-diretamente-a-partir-do-siafi"><i class="fa fa-check"></i><b>2.2</b> Como fazer isso diretamente a partir do Siafi?</a><ul>
<li class="chapter" data-level="2.2.1" data-path="projeto-caixa.html"><a href="projeto-caixa.html#movimentações-diárias-do-limite-de-saque-item-de-informação-limites-de-saque"><i class="fa fa-check"></i><b>2.2.1</b> Movimentações diárias do Limite de Saque (item de informação: “LIMITES DE SAQUE”)</a></li>
<li class="chapter" data-level="2.2.2" data-path="projeto-caixa.html"><a href="projeto-caixa.html#pagamentos-diários-item-de-informação-pagamentos-totais"><i class="fa fa-check"></i><b>2.2.2</b> Pagamentos diários (item de informação: “PAGAMENTOS TOTAIS”)</a></li>
<li class="chapter" data-level="2.2.3" data-path="projeto-caixa.html"><a href="projeto-caixa.html#movimentações-diárias-em-obrigações-a-pagar-item-de-informação-valores-liquidados-a-pagar-exercicio-rp"><i class="fa fa-check"></i><b>2.2.3</b> Movimentações diárias em obrigações a pagar (item de informação: “VALORES LIQUIDADOS A PAGAR (EXERCICIO + RP)”)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="projeto-caixa.html"><a href="projeto-caixa.html#o-que-analisar"><i class="fa fa-check"></i><b>2.3</b> O que analisar?</a></li>
<li class="chapter" data-level="2.4" data-path="projeto-caixa.html"><a href="projeto-caixa.html#questões-iniciais-a-serem-investigadas"><i class="fa fa-check"></i><b>2.4</b> Questões iniciais a serem investigadas</a></li>
<li class="chapter" data-level="2.5" data-path="projeto-caixa.html"><a href="projeto-caixa.html#inspirações"><i class="fa fa-check"></i><b>2.5</b> Inspirações</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bases-de-dados.html"><a href="bases-de-dados.html"><i class="fa fa-check"></i><b>3</b> Bases de dados</a></li>
<li class="chapter" data-level="4" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html"><i class="fa fa-check"></i><b>4</b> Relatório 1: Validação e Compreensão dos Dados</a><ul>
<li class="chapter" data-level="4.1" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#introdução-1"><i class="fa fa-check"></i><b>4.1</b> Introdução</a></li>
<li class="chapter" data-level="4.2" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#questões-elementares"><i class="fa fa-check"></i><b>4.2</b> Questões elementares</a></li>
<li class="chapter" data-level="4.3" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#bases-de-dados-levantadas-para-endereçar-as-questões"><i class="fa fa-check"></i><b>4.3</b> Bases de dados levantadas para endereçar as questões</a></li>
<li class="chapter" data-level="4.4" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#base-1-movimentações-diárias-do-limite-de-saque"><i class="fa fa-check"></i><b>4.4</b> Base 1: Movimentações diárias do Limite de Saque</a></li>
<li class="chapter" data-level="4.5" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#base-2-pagamentos-diários"><i class="fa fa-check"></i><b>4.5</b> Base 2: Pagamentos diários</a></li>
<li class="chapter" data-level="4.6" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#base-3-movimentações-diárias-em-obrigações-a-pagar"><i class="fa fa-check"></i><b>4.6</b> Base 3: Movimentações diárias em obrigações a pagar</a></li>
<li class="chapter" data-level="4.7" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#tabelas-derivadas"><i class="fa fa-check"></i><b>4.7</b> Tabelas Derivadas</a><ul>
<li class="chapter" data-level="4.7.1" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#disponibilidades-líquidas-diárias"><i class="fa fa-check"></i><b>4.7.1</b> Disponibilidades líquidas Diárias</a></li>
<li class="chapter" data-level="4.7.2" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#vinculação-de-pagamentos"><i class="fa fa-check"></i><b>4.7.2</b> Vinculação de Pagamentos</a></li>
<li class="chapter" data-level="4.7.3" data-path="relatório-1-validação-e-compreensão-dos-dados.html"><a href="relatório-1-validação-e-compreensão-dos-dados.html#limimtes-de-saque-por-tipo-de-documento"><i class="fa fa-check"></i><b>4.7.3</b> Limimtes de Saque Por Tipo De Documento</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="título-a.html"><a href="título-a.html"><i class="fa fa-check"></i><b>5</b> Título A</a></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html"><i class="fa fa-check"></i>Referências</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado com bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Documentação do projeto ‘Execução Orçamentária e Financeira do Governo Federal’ (STN/BID)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="projeto-caixa" class="section level1">
<h1><span class="header-section-number">Capítulo 2</span> Projeto Caixa</h1>
<p><em>Tiago</em></p>
<p>A ideia deste projeto é analisar o comportamento do caixa e das obrigações financeiras dos órgãos federais, com a finalidade de fornecer informações para a gestão da programação financeira por parte do Tesouro Nacional, além de identificar oportunidades de melhorias nesse processo, e possivelmente fundamentar a criação de indicadores para avaliação da gestão financeira das unidades do Governo Federal.</p>
<p>Vamos elencar aqui alguns aspectos, ou componentes, importantes do projeto, sem uma ordem específica.</p>
<div id="é-preciso-de-início-conhecer-o-perfil-das-despesas-e-receitas-orçamentárias-desses-órgãos." class="section level2">
<h2><span class="header-section-number">2.1</span> É preciso de início conhecer o perfil das despesas e receitas orçamentárias desses órgãos.</h2>
<p>Vamos começar com um perfil das despesas do Ministério da Justiça (que já tem um excelente sistema de acompanhamento das despesas).</p>
<p><strong>Tentar compatibilizar as informações orçamentárias (classificações como função, subfunção, ação, grupo de despesa, indicadores orçamentários etc.) com as informações financeiras (vinculação de pagamento, essencialmente).</strong></p>
<p>O que estamos chamando de <em>classificadores orçamentários</em>: Função, Subfunção, Programa, Ação, Grupo de Despesa, Modalidade de Aplicação, Elemento de Despesa, Indicador de Resultado EOF, Indicador de Exceção Decreto.</p>
<p>O que estamos chamando de <em>classificadores financeiros</em>: Vinculação de Pagamento, essencialmente.</p>
<p>A <em>fonte de recurso</em> é um caso especial, é um classificador comum a esses dois contextos, orçamentário e financeiro.</p>
</div>
<div id="como-fazer-isso-diretamente-a-partir-do-siafi" class="section level2">
<h2><span class="header-section-number">2.2</span> Como fazer isso diretamente a partir do Siafi?</h2>
<p>Algumas ideias, a serem testadas:</p>
<ul>
<li><p>analisar as despesas pagas, pelos classificadores, pelo número da nota de empenho e pelo número do documento de pagamento; e relacionar documento de pagamento x nota de empenho x vinculação de pagamento pelo campo “inscrição” do documento de pagamento.</p></li>
<li><p>analisar as despesas pagas, pelos classificadores, pelo número da nota de empenho e pelo número do documento de pagamento; e tentar compatibilizar com as informações dos pagamentos efetuados, por vinculação de pagamento e número do documento de pegamento.</p></li>
<li><p>Mais simples: parecido com o anterior, a partir da tabela com as despesas pagas detalhadas pelos classificadores orçamentários, empenho e documento de pagamento, buscar a <em>vinculação de pagamento</em> de uma tabela com toda a movimentação do limite de saque detalhada por documento. Assim, quando a movimentação do limite de saque for um pagamento, o documento correspondente, um documento de pagamento, pode ser usado como chave para relacionar as duas tabelas.</p></li>
</ul>
<p>Teríamos então três extrações: uma para a movimentação no caixa e outras duas, semelhantes em termos de detalhamentos, para os pagamentos totais e para as obrigações a pagar. A relação dos campos está simplificada, e os campos <strong>destacados</strong> são aqueles que só aparecem na tabela 1, ou que só aparecem nas tabelas 2 e 3.</p>
<div id="movimentações-diárias-do-limite-de-saque-item-de-informação-limites-de-saque" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Movimentações diárias do Limite de Saque (item de informação: “LIMITES DE SAQUE”)</h3>
<ul>
<li>Órgão Máximo</li>
<li>Órgão</li>
<li>UG</li>
<li><strong>Vinculação de Pagamento</strong></li>
<li>Fonte Detalhada</li>
<li>Fonte (posições 3 e 4 da fonte detalhada – exemplo: se a fonte detalhada é: <code>0100123456</code>, a fonte será <code>00</code>)</li>
<li>Documento Lançamento [chave para fazer a junção com tabela (2)]</li>
<li>Movimento / Valor Financeiro</li>
</ul>
</div>
<div id="pagamentos-diários-item-de-informação-pagamentos-totais" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Pagamentos diários (item de informação: “PAGAMENTOS TOTAIS”)</h3>
<ul>
<li>Órgão Máximo</li>
<li>Órgão</li>
<li>UG</li>
<li>Fonte Detalhada</li>
<li>Fonte (posições 3 e 4 da fonte detalhada – exemplo: se a fonte detalhada é: <code>0100123456</code>, a fonte será <code>00</code>)</li>
<li><strong>Função</strong></li>
<li><strong>Subfunção</strong></li>
<li><strong>Programa</strong></li>
<li><strong>Ação</strong></li>
<li><strong>Grupo de Despesa</strong></li>
<li><strong>Modalidade de Aplicação</strong></li>
<li><strong>Elemento de Despesa</strong></li>
<li><strong>Indicador de Resultado EOF</strong> (indica se a despesa é primária ou financeira, entre outras coisas)</li>
<li><strong>Indicador de Exceção Decreto</strong></li>
<li><strong>Ano do Empenho</strong></li>
<li><strong>Empenho</strong></li>
<li><strong>Órgão Máximo da UO</strong> (o “dono” original do orçamento, que pode ter sido em algum momento “descentralizado”, isto é, transferido, para um óutro “Órgão Máximo” – ou seja, se o Órgão Máximo da UO é diferente do Órgão Máximo, significa que a unidade está realizando uma despesa com orçamento de outro órgão)</li>
<li>Documento Lançamento [chave para fazer a junção com tabela (1)]</li>
<li>Movimento / Valor Financeiro</li>
</ul>
</div>
<div id="movimentações-diárias-em-obrigações-a-pagar-item-de-informação-valores-liquidados-a-pagar-exercicio-rp" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Movimentações diárias em obrigações a pagar (item de informação: “VALORES LIQUIDADOS A PAGAR (EXERCICIO + RP)”)</h3>
<ul>
<li>Órgão Máximo</li>
<li>Órgão</li>
<li>UG</li>
<li>Fonte Detalhada</li>
<li>Fonte (posições 3 e 4 da fonte detalhada – exemplo: se a fonte detalhada é: <code>0100123456</code>, a fonte será <code>00</code>)</li>
<li><strong>Função</strong></li>
<li><strong>Subfunção</strong></li>
<li><strong>Programa</strong></li>
<li><strong>Ação</strong></li>
<li><strong>Grupo de Despesa</strong></li>
<li><strong>Modalidade de Aplicação</strong></li>
<li><strong>Elemento de Despesa</strong></li>
<li><strong>Indicador de Resultado EOF</strong> (indica se a despesa é primária ou financeira, entre outras coisas)</li>
<li><strong>Indicador de Exceção Decreto</strong></li>
<li><strong>Ano do Empenho</strong></li>
<li><strong>Empenho</strong></li>
<li><strong>Órgão Máximo da UO</strong> (o “dono” original do orçamento, que pode ter sido em algum momento “descentralizado”, isto é, transferido, para um óutro “Órgão Máximo” – ou seja, se o Órgão Máximo da UO é diferente do Órgão Máximo, significa que a unidade está realizando uma despesa com orçamento de outro órgão)</li>
<li>Documento Lançamento (acho que não será necessário)</li>
<li>Movimento / Valor Financeiro</li>
</ul>
</div>
</div>
<div id="o-que-analisar" class="section level2">
<h2><span class="header-section-number">2.3</span> O que analisar?</h2>
<p>Com <strong>(1)</strong> e <strong>(3)</strong> podemos obter os saldos diários do caixa (tabela <strong>(1)</strong>) e das obrigações a pagar (tabela <strong>(3)</strong>) – e calcular a <em>disponibilidade líquida diária</em>, como sendo o saldo do caixa (item “LIMITES DE SAQUE”) subtraído das obrigações a pagar (item “VALORES LIQUIDADOS A PAGAR (EXERCICIO + RP)”)–, para cada unidade gestora ou órgão, e para cada fonte de recursos. Para isso sumarizaríamos os dados por DIA_LANC, UG, ORGAO, FONTE e ITEM_INFORMACAO. Essa seria a tabela <strong>(i)</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># tem ID_DOCUMENTO_CCOR estranho (com valores -7)</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># tem ID_DOCUMENTO == SALDO INICIAL 2017 2018 2019</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># o que é obrigacoes_a_pagar negativa?</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#inner_join: 96113     </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#left_join: 151432  </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#right_join: 110739</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#full_join: 166058</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">disponibilidades_liquidas_diarias &lt;-<span class="st"> </span><span class="kw">inner_join</span>(</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  lim_saque <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="st">    </span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">      NO_DIA_COMPLETO,</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">      NO_UG,</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">      NO_ORGAO,</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">      <span class="co"># NO_ITEM_INFORMACAO,</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">      NO_FONTE_RECURSO</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">      <span class="dt">saldo_diario =</span> <span class="kw">sum</span>(SALDORITEMINFORMAO)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    ),</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  obrigacoes <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="st">    </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">      <span class="dt">NO_ORGAO =</span> NO_ORGAO...<span class="dv">16</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="st">    </span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">      NO_DIA_COMPLETO,</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">      NO_UG,</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">      NO_ORGAO,</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">      <span class="co"># NO_ITEM_INFORMACAO,</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">      NO_FONTE_RECURSO</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">      <span class="dt">obrigacoes_a_pagar =</span> <span class="kw">sum</span>(SALDORITEMINFORMAO)</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    )</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    <span class="dt">disponibilidade_liquida =</span> saldo_diario <span class="op">-</span><span class="st"> </span>obrigacoes_a_pagar</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="st">  </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">    <span class="op">!</span><span class="kw">str_detect</span>(NO_DIA_COMPLETO , <span class="st">&quot;-09/00/&quot;</span>)</a>
<a class="sourceLine" id="cb1-41" data-line-number="41">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="st">  </span>ungroup <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">    <span class="dt">NO_DIA_COMPLETO =</span> <span class="kw">dmy</span>(NO_DIA_COMPLETO)</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="st">  </span>padr<span class="op">::</span><span class="kw">pad</span>(<span class="dt">group =</span> <span class="kw">c</span>(<span class="st">&quot;NO_UG&quot;</span>, <span class="st">&quot;NO_ORGAO&quot;</span>, <span class="st">&quot;NO_FONTE_RECURSO&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">    <span class="dt">ano =</span> <span class="kw">year</span>(NO_DIA_COMPLETO),</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">    <span class="dt">mes =</span> <span class="kw">month</span>(NO_DIA_COMPLETO),</a>
<a class="sourceLine" id="cb1-50" data-line-number="50">    <span class="dt">dia =</span> <span class="kw">day</span>(NO_DIA_COMPLETO),</a>
<a class="sourceLine" id="cb1-51" data-line-number="51">    <span class="dt">paded =</span> <span class="op">!</span><span class="kw">is.na</span>(saldo_diario)</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">fill</span>(saldo_diario, obrigacoes_a_pagar, disponibilidade_liquida) </a></code></pre></div>
<pre><code>## Joining, by = c(&quot;NO_DIA_COMPLETO&quot;, &quot;NO_UG&quot;, &quot;NO_ORGAO&quot;, &quot;NO_FONTE_RECURSO&quot;)</code></pre>
<pre><code>## Warning: datetime variable does not vary for 32 of the groups, no padding
## applied on this / these group(s)</code></pre>
<pre><code>## pad applied on the interval: day</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># explorando a relacao fonte x ug</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">library</span>(networkD3)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">abrevia_palavras &lt;-<span class="st"> </span><span class="cf">function</span>(str) {</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  str <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;SUPERINTENDENCIA&quot;</span>, <span class="st">&quot;SUPT&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;REGIONAL&quot;</span>, <span class="st">&quot;REG&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ADMINISTRACAO&quot;</span>, <span class="st">&quot;ADM&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;DIRETORIA&quot;</span>, <span class="st">&quot;DIR&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;COORDENACAO&quot;</span>, <span class="st">&quot;COORD&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;NACIONAL&quot;</span>, <span class="st">&quot;NAC&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;FINANCEIROS&quot;</span>, <span class="st">&quot;FIN&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;PROGNOSTICOS&quot;</span>, <span class="st">&quot;PROG&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ESTADO&quot;</span>, <span class="st">&quot;EST&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;POLITICAS&quot;</span>, <span class="st">&quot;POL&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;RECURSOS&quot;</span>, <span class="st">&quot;REC&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ORDINARIOS&quot;</span>, <span class="st">&quot;ORD&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="st">    </span><span class="kw">str_replace_all</span>(<span class="st">&quot;ARRECADADOS&quot;</span>, <span class="st">&quot;ARREC&quot;</span>)</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb5-20" data-line-number="20"></a>
<a class="sourceLine" id="cb5-21" data-line-number="21">data =<span class="st"> </span>disponibilidades_liquidas_diarias <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="st">  </span>ungroup <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="st">  </span><span class="kw">filter</span>(NO_DIA_COMPLETO <span class="op">==</span><span class="st"> </span><span class="kw">first</span>(NO_DIA_COMPLETO), saldo_diario <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="st">  </span><span class="kw">select</span>(NO_FONTE_RECURSO, NO_UG, saldo_diario) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">    <span class="dt">NO_FONTE_RECURSO =</span> <span class="kw">abrevia_palavras</span>(NO_FONTE_RECURSO),</a>
<a class="sourceLine" id="cb5-27" data-line-number="27">    <span class="dt">NO_UG =</span> <span class="kw">abrevia_palavras</span>(NO_UG),</a>
<a class="sourceLine" id="cb5-28" data-line-number="28">    <span class="dt">NO_FONTE_RECURSO_id =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(NO_FONTE_RECURSO)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">    <span class="dt">NO_UG_id =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(NO_UG)) <span class="op">+</span><span class="st"> </span><span class="kw">max</span>(NO_FONTE_RECURSO_id)</a>
<a class="sourceLine" id="cb5-30" data-line-number="30">  )</a>
<a class="sourceLine" id="cb5-31" data-line-number="31">data_node =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">node =</span> data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(NO_FONTE_RECURSO, NO_UG) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">sort</span>(<span class="kw">unique</span>(.x))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(c))</a>
<a class="sourceLine" id="cb5-32" data-line-number="32">networkD3<span class="op">::</span><span class="kw">sankeyNetwork</span>(<span class="dt">Links =</span> data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(), <span class="dt">Nodes =</span> data_node, <span class="dt">Source =</span> <span class="st">&#39;NO_FONTE_RECURSO_id&#39;</span>,</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">                         <span class="dt">Target =</span> <span class="st">&#39;NO_UG_id&#39;</span>, <span class="dt">Value =</span> <span class="st">&#39;saldo_diario&#39;</span>, <span class="dt">NodeID =</span> <span class="st">&#39;node&#39;</span>,</a>
<a class="sourceLine" id="cb5-34" data-line-number="34">                         <span class="dt">units =</span> <span class="st">&#39;BRL&#39;</span>)</a></code></pre></div>
<pre><code>## Links is a tbl_df. Converting to a plain data frame.</code></pre>
<div id="htmlwidget-162d62b89b9e3f5aa4a1" style="width:672px;height:480px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-162d62b89b9e3f5aa4a1">{"x":{"links":{"source":[5,8,5,4,5,5,5,2,5,5,5,3,5,5,8,5,4,5,7,7,8,5,4,0,6,6,5,8,4,7,8,4,8,4,8,8,7,8,8,4,4,7,7,8,1,8,4,4,5,8,7,8,8,8,8,8,8,8,8,8,5,7,8,8,8,7,8,8,8],"target":[9,9,10,11,12,13,14,15,16,17,18,19,19,20,21,22,23,24,24,25,25,26,27,28,29,30,31,31,48,48,49,50,50,51,51,52,53,53,54,55,56,56,57,58,59,59,60,61,32,32,33,33,34,35,36,37,38,39,40,41,42,42,42,43,44,45,45,46,47],"value":[15286.17,2.55795384873636e-13,1103.9,125760.76,9921.71,17717.7,999.999999999998,916.040000000001,14345.29,297.04,4.20000000000014,17415.97,16111.98,65213.28,601.8,4756.75,385.619999999995,103985.75,281855.4,122997.08,3209.26000000009,22931.24,15472.29,300000,231.409999999999,294906.71,1.4210854715202e-14,51438.64,2722.5,21.9000000000005,426.849999999999,760.049999999994,18234.93,303.71,6999.17999999999,3522.75,1001.97,20901.72,2167.5,350.54,276.36,754.860000000001,8.5265128291212e-13,1300000,2.72848410531878e-12,3289.48,83.5800000000015,5477.96,1.4210854715202e-14,2662.32,254.31,967.52,9246.46,8872.22,7221,1.4495071809506e-12,17677.64,32159.56,13323.52,22682.78,6218.34000000001,4406.59,1445.78,13.4499999999961,14966.48,2500.77,44613.2,39802.65,11629.75]},"nodes":{"name":["DOACOES DE PESSOAS FIS/INSTIT.PUBL.E PRIV.NAC","REC DE CONCESSOES E PERMISSOES","REC DEST.A MANUT.E DES.DO ENSINO","REC LIVRES DA SEGURIDADE SOCIAL","REC NAO-FIN DIRETAM. ARREC","REC ORD","RECEITAS DE CONCURSOS DE PROG","REMUNERACAO DAS DISPONIB. DO TESOURO NAC","TX/MUL.P/PODER DE POLICIA E MUL.PROV.PROC.JUD","ACADEMIA NAC DE POLICIA","COMISSAO DE ANISTIA","CONSELHO ADMINISTRATIVO DE DEFESA ECONOMICA","COORD DE GESTAO DE PESSOAS - DEPEN","COORD REG ALTO PURUS","COORD REG DE CUIABA/MT","COORD REG MEDIO PURUS/AM","COORD REG PASSO FUNDO/RS","COORD REG RORAIMA/RR","COORD REG TAPAJOS/PA","COORD REG XAVANTE/MT","COORD-GERAL DE GESTAO DE PESSOAS-CGGP","COORD-GERAL DE OPERACOES","DELEGACIA DE POLICIA FEDERAL EM FOZ DO IGUACU","DEPTO. DE POLICIA RODOV. FEDERAL - DIR. GERAL","DEPTO.DE POLICIA RODOVIARIA FEDERAL","DIR TECNICO-CIENTIFICA-DITEC/DPF","FUNAI-COORD REG DE JI-PARANA/RO","FUNDO NAC ANTIDROGAS","FUNDO NAC DO IDOSO","PENITENCIARIA FEDERAL DE CAMPO GRANDE - MS","PENITENCIARIA FEDERAL EM CATANDUVAS - PR","SUPT REG DA POLICIA FEDERAL EM MG","SUPT REG NO DISTRITO FEDERAL","SUPT REG NO EST DA BA","SUPT REG NO EST DE AL","SUPT REG NO EST DE GO","SUPT REG NO EST DE RO","SUPT REG NO EST DE RR","SUPT REG NO EST DE SC","SUPT REG NO EST DE SE","SUPT REG NO EST DE TO","SUPT REG NO EST DO AM","SUPT REG NO EST DO CE","SUPT REG NO EST DO MT","SUPT REG NO EST DO PA","SUPT REG NO EST DO PR","SUPT REG NO EST DO RN","SUPT REG NO EST DO RS","SUPT REG. POL. RODV. FEDERAL-AL","SUPT REG. POL. RODV. FEDERAL-AP","SUPT REG. POL. RODV. FEDERAL-CE","SUPT REG. POL. RODV. FEDERAL-DF","SUPT REG. POL. RODV. FEDERAL-ES","SUPT REG. POL. RODV. FEDERAL-MA","SUPT REG. POL. RODV. FEDERAL-MG","SUPT REG. POL. RODV. FEDERAL-MS","SUPT REG. POL. RODV. FEDERAL-PA","SUPT REG. POL. RODV. FEDERAL-PE","SUPT REG. POL. RODV. FEDERAL-PR","SUPT REG. POL. RODV. FEDERAL-RS","SUPT REG. POL. RODV. FEDERAL-SE","SUPT REG. POL. RODV. FEDERAL-TO"],"group":["DOACOES DE PESSOAS FIS/INSTIT.PUBL.E PRIV.NAC","REC DE CONCESSOES E PERMISSOES","REC DEST.A MANUT.E DES.DO ENSINO","REC LIVRES DA SEGURIDADE SOCIAL","REC NAO-FIN DIRETAM. ARREC","REC ORD","RECEITAS DE CONCURSOS DE PROG","REMUNERACAO DAS DISPONIB. DO TESOURO NAC","TX/MUL.P/PODER DE POLICIA E MUL.PROV.PROC.JUD","ACADEMIA NAC DE POLICIA","COMISSAO DE ANISTIA","CONSELHO ADMINISTRATIVO DE DEFESA ECONOMICA","COORD DE GESTAO DE PESSOAS - DEPEN","COORD REG ALTO PURUS","COORD REG DE CUIABA/MT","COORD REG MEDIO PURUS/AM","COORD REG PASSO FUNDO/RS","COORD REG RORAIMA/RR","COORD REG TAPAJOS/PA","COORD REG XAVANTE/MT","COORD-GERAL DE GESTAO DE PESSOAS-CGGP","COORD-GERAL DE OPERACOES","DELEGACIA DE POLICIA FEDERAL EM FOZ DO IGUACU","DEPTO. DE POLICIA RODOV. FEDERAL - DIR. GERAL","DEPTO.DE POLICIA RODOVIARIA FEDERAL","DIR TECNICO-CIENTIFICA-DITEC/DPF","FUNAI-COORD REG DE JI-PARANA/RO","FUNDO NAC ANTIDROGAS","FUNDO NAC DO IDOSO","PENITENCIARIA FEDERAL DE CAMPO GRANDE - MS","PENITENCIARIA FEDERAL EM CATANDUVAS - PR","SUPT REG DA POLICIA FEDERAL EM MG","SUPT REG NO DISTRITO FEDERAL","SUPT REG NO EST DA BA","SUPT REG NO EST DE AL","SUPT REG NO EST DE GO","SUPT REG NO EST DE RO","SUPT REG NO EST DE RR","SUPT REG NO EST DE SC","SUPT REG NO EST DE SE","SUPT REG NO EST DE TO","SUPT REG NO EST DO AM","SUPT REG NO EST DO CE","SUPT REG NO EST DO MT","SUPT REG NO EST DO PA","SUPT REG NO EST DO PR","SUPT REG NO EST DO RN","SUPT REG NO EST DO RS","SUPT REG. POL. RODV. FEDERAL-AL","SUPT REG. POL. RODV. FEDERAL-AP","SUPT REG. POL. RODV. FEDERAL-CE","SUPT REG. POL. RODV. FEDERAL-DF","SUPT REG. POL. RODV. FEDERAL-ES","SUPT REG. POL. RODV. FEDERAL-MA","SUPT REG. POL. RODV. FEDERAL-MG","SUPT REG. POL. RODV. FEDERAL-MS","SUPT REG. POL. RODV. FEDERAL-PA","SUPT REG. POL. RODV. FEDERAL-PE","SUPT REG. POL. RODV. FEDERAL-PR","SUPT REG. POL. RODV. FEDERAL-RS","SUPT REG. POL. RODV. FEDERAL-SE","SUPT REG. POL. RODV. FEDERAL-TO"]},"options":{"NodeID":"node","NodeGroup":"node","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"BRL","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
<p>Com <strong>(1)</strong> e <strong>(2)</strong> poderíamos relacionar, no contexto dos pagamentos, as informações orçamentárias com as vinculações de pagamento, obtendo uma tabela <strong>(ii)</strong>. Partiríamos de <strong>(2)</strong> e faríamos um join com <strong>(1)</strong>, por “Documento de Lançamento”, para trazer a “Vinculação de Pagamento” da tabela <strong>(1)</strong> (acho que seria interessante trazer também o campo de Movimento / Valor da tabela <strong>(1)</strong>, porque pode acontecer de um mesmo pagamento ter utilizado mais de uma <em>vinculação de pagamento</em>. Nesse caso, o valor mostrado na tabela <strong>(2)</strong> seria o valor consolidado, e precisaríamos do ).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">vinculacao_de_pagamentos &lt;-<span class="st"> </span><span class="kw">inner_join</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  pagamentos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">      NO_DIA_COMPLETO,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">      ID_DOCUMENTO</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">      <span class="dt">pagamento =</span> <span class="kw">sum</span>(SALDORITEMINFORMAO)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    ),</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  lim_saque <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">    </span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">      NO_DIA_COMPLETO,</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">      ID_DOCUMENTO</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    )  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">      <span class="dt">NO_VINCULACAO_PAGAMENTO =</span> <span class="kw">first</span>(NO_VINCULACAO_PAGAMENTO),</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">      <span class="dt">vinculacoes_distintas =</span> <span class="kw">n_distinct</span>(NO_VINCULACAO_PAGAMENTO),</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">      <span class="dt">saldo_diario =</span> <span class="kw">sum</span>(SALDORITEMINFORMAO)</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">    )</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb7-22" data-line-number="22">    <span class="dt">pagamento_por_saldo =</span> pagamento<span class="op">/</span>saldo_diario</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">  )</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;NO_DIA_COMPLETO&quot;, &quot;ID_DOCUMENTO&quot;)</code></pre>
<p>Finalmente com <strong>(1)</strong>, podemos analisar as movimentações para tipo de documento, obtendo um histórico das movimentações de cada órgão e cada UG, a que chamaremos de <strong>(iii)</strong>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">lim_saque_por_tipo_de_documento &lt;-<span class="st"> </span>lim_saque <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="dt">tipo_de_documento =</span> <span class="kw">str_extract</span>(ID_DOCUMENTO, <span class="st">&quot;[A-Z]+&quot;</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    tipo_de_documento,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    NO_DIA_COMPLETO,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    NO_UG,</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    NO_ORGAO,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    NO_ITEM_INFORMACAO,</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    NO_FONTE_RECURSO</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    <span class="dt">saldo_diario =</span> <span class="kw">sum</span>(SALDORITEMINFORMAO)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">  )</a></code></pre></div>
</div>
<div id="questões-iniciais-a-serem-investigadas" class="section level2">
<h2><span class="header-section-number">2.4</span> Questões iniciais a serem investigadas</h2>
<ol style="list-style-type: lower-alpha">
<li>Qual o comportamento do caixa e das obrigações a pagar (e da disponibilidade líquida) no período analisado? Por órgão? Por unidade? Por fonte? Por unidade e por fonte? (Tabela (i))</li>
</ol>
<p>(semelhante ao que foi feito superficialmente <a href="https://github.com/TesouroNacional/puddles-puddles">aqui</a>, só que melhor, com mais rigor.)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">112</span>);disponibilidades_liquidas_diarias <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(NO_UG <span class="op">%in%</span><span class="st"> </span><span class="kw">sample</span>(NO_UG, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">         NO_DIA_COMPLETO <span class="op">&gt;</span><span class="st"> &quot;2019-06-01&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(NO_DIA_COMPLETO, NO_UG) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="dt">saldo_diario =</span> <span class="kw">sum</span>(saldo_diario),</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="dt">obrigacoes_a_pagar =</span> <span class="kw">sum</span>(obrigacoes_a_pagar),</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">    <span class="dt">disponibilidade_liquida =</span> <span class="kw">sum</span>(disponibilidade_liquida)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">  </span>ungroup <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="st">  </span><span class="kw">gather</span>(movimentacao, valor, saldo_diario, obrigacoes_a_pagar, disponibilidade_liquida) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(NO_DIA_COMPLETO), <span class="dt">y =</span> valor, <span class="dt">size =</span> NO_UG, <span class="dt">colour =</span> movimentacao), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_step</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(NO_DIA_COMPLETO)), <span class="dt">y =</span> valor, <span class="dt">colour =</span> movimentacao), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="01-instrucoes_tiago_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>a1. Há casos em que unidades de um mesmo órgão permanecem com disponibilidade líquida negativa, enquanto outras unidades desse mesmo órgão estão com disponibilidade positiva? E se levarmos em consideração a fonte de recursos, há casos em que o órgão passa por períodos com disponibilidade negativa numa fonte, enquanto há recursos disponíveis em outra fonte? E se levarmos em consideração as duas coisas (unidade + fonte: ou seja, uma unidade de um mesmo órgão fica com disponibilidade negativa numa fonte, enquanto outra unidade desse mesmo órgão possui disponibilidade positiva nessa mesma fonte?)</p>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>A partir de (ii), como as classificações orçamentárias se relacionam com as classificações financeiras? Especificamente, é possível identificar certos tipos de despesas que são sempre (ou frequentemente) pagas com recursos de determinadas vinculações?</p></li>
<li><p>Se for possível a identificação mencionada em (b), então, poderíamos fazer uma versão de (i) em que os dados estariam detalhados também por <em>vinculação de pagamento</em> e alguns <em>classificadores orçamentários</em>. Com o resultado de (b), poderíamos então refinar (a) e (a1), estimando a disponibilidade líquida para cada vinculação, considerando as classificações orçamentárias das obrigações. Por exemplo, a unidade pode ter saldo suficiente para cobrir todas as suas obrigações; mas, quando se analisam na prática que vinculações costumam pagar que obrigações (algo obtido de (b)), pode-se observar que na verdade há suficiência em algumas vinculações, mas insuficiência em outras.</p></li>
<li><p>Qual o comportamento do caixa das unidades, em termos de movimentações? Para isso, podemos considerar os seguintes tipos de movimentações (sete, por enquanto), de acordo com o sinal do valor da movimentação, e do tipo do documento de lançamento (posições 16 e 17 do campo <code>ID_DOCUMENTO</code>):</p></li>
</ol>
<ul>
<li>Receitas próprias - movimentos positivos por RAs;</li>
<li>Recebimentos de recursos financeiros - movimentos positivos por PFs;</li>
<li>Anulações de pagamentos - movimentos positivos por DF, DR, GF, GP, GR ou OB;</li>
<li>Ajustes contábeis - movimentos por NS;</li>
<li>Pagamentos - movimentos negativos por DF, DR, GF, GP, GR ou OB;</li>
<li>Ajustes na receita arrecadada (anulações, retificações etc.): movimentos negativos por RA; e</li>
<li>Liberações de recursos para outros órgãos - movimentos negativos por PFs.</li>
</ul>
<ol start="5" style="list-style-type: lower-alpha">
<li>Provavelmente vamos observar grandes recebimentos de recursos financeiros seguidos por grandes despesas. Nesses casos, em geral, qual o intervalo entre essas duas operações?</li>
</ol>
</div>
<div id="inspirações" class="section level2">
<h2><span class="header-section-number">2.5</span> Inspirações</h2>
<p>NatGeo immigrations. Pode ser interessante fazer algo semelhante para visualizar e comparar o saldo diário das unidades.</p>
<p><img src="natgeo.jpg" /></p>
<p><a href="https://twitter.com/aLucasLopez/status/1153646875427385344?s=20" class="uri">https://twitter.com/aLucasLopez/status/1153646875427385344?s=20</a></p>
<p>Para mostrar a composição das despesas, vamos usar um diagrama de bolhas em D3 semelhante <a href="https://vallandingham.me/bubble_charts_with_d3v4.html">ao do Jim Vallandingham</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bases-de-dados.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-instrucoes_tiago.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
